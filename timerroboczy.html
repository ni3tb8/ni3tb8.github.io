<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timer montażowy - Ciemny tryb</title>
  
  <!-- Google Fonts: Titillium Web -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600&display=swap');

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Titillium Web', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 { font-size: 2rem; margin-bottom: 1rem; text-align: center; }
    form {
      display: flex; gap: 10px; margin-bottom: 20px; width: 45%;
    }
    input[type="text"] {
      flex: 1; padding: 10px; border: 1px solid #333; border-radius: 4px;
      background-color: #1e1e1e; color: #f0f0f0; font-size: 1rem;
      font-family: 'Titillium Web', sans-serif;
      outline: none;
    }
    .b-ogolny {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: #8196da; color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
      transition-duration: 0.4s;
    }
    .b-wznow {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: #72bb78; color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
      transition-duration: 0.4s;
    }
    .b-zatrzymaj {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: rgb(182, 158, 107); color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
      transition-duration: 0.4s;
    }
    .b-zakoncz {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: rgb(190, 105, 105); color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
      transition-duration: 0.4s;
    }

    .b-ogolny:hover {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: #a2b3eb; color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }
    .b-wznow:hover {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: #94cf99; color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }
    .b-zatrzymaj:hover {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: rgb(204, 183, 137); color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }
    .b-zakoncz:hover {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: rgb(211, 135, 135); color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }

    .b-ogolny:active {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: #5c71b9; color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }
    .b-wznow:active {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: #55a75c; color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }
    .b-zatrzymaj:active {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: rgb(165, 139, 82); color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }
    .b-zakoncz:active {
      font-size: 0.95rem;
      padding: 10px 15px; border: none; border-radius: 4px;
      background-color: rgb(167, 76, 76); color: #121212; font-weight: 600;
      cursor: pointer; font-family: 'Titillium Web', sans-serif;
    }
    #timersContainer { width: 70%; margin-top: 10px; }
    .timer {
      display: flex; align-items: center; justify-content: space-between;
      background-color: #1e1e1e; padding: 15px; margin-bottom: 10px; border-radius: 6px;
    }
    .name {
      font-size: 1.1rem; font-weight: 600;
      font-family: 'Titillium Web', sans-serif;
    }
    .right {
      display: flex; align-items: center; gap: 10px;
    }
    .time {
      padding: 5px 10px; background-color: #414141; color: #f0f0f0;
      border-radius: 4px; font-family: 'Titillium Web', sans-serif;
      font-size: 1rem;
    }
    .controls button {
      margin: 0; background-color: #333; color: #f0f0f0;
      font-family: 'Titillium Web', sans-serif;
    }
  </style>
</head>
<body>
  <h1>Timer montażowy</h1>
  <form id="timerForm">
    <input type="text" id="timerName" placeholder="Nazwa zadania" required autocomplete="off">
    <button type="submit" class="b-ogolny">Uruchom</button>
  </form>
  <div id="timersContainer"></div>

    <script>
    const timers = {};
    let timerIdCounter = 0;

    function saveTimers() {
      const data = Object.entries(timers).map(([id, t]) => ({
        id: Number(id), name: t.name, elapsed: t.elapsed,
        running: t.running, savedAt: Date.now()
      }));
      localStorage.setItem('timers', JSON.stringify(data));
    }

    function loadTimers() {
      const data = JSON.parse(localStorage.getItem('timers') || '[]');
      const now = Date.now();
      data.forEach(item => {
        const { id, name, elapsed, running, savedAt } = item;
        const adjustedElapsed = running ? elapsed + (now - savedAt) : elapsed;
        if (id > timerIdCounter) timerIdCounter = id;
        timers[id] = { name, elapsed: adjustedElapsed, running,
          animationFrame: null,
          startTime: Date.now() - adjustedElapsed
        };
        renderTimer(id);
        if (running) updateTimer(id);
      });
    }

    function renderTimer(id) {
      const t = timers[id];
      const container = document.getElementById('timersContainer');
      const timerEl = document.createElement('div');
      timerEl.className = 'timer';
      timerEl.id = 'timer-' + id;
      const btnClass = t.running ? 'b-zatrzymaj' : 'b-wznow';
      const btnText = t.running ? 'Zatrzymaj' : 'Wznów';
      timerEl.innerHTML = `
        <div class="name">${t.name}</div>
        <div class="right">
          <div class="time" id="time-${id}">${formatTime(t.elapsed)}</div>
          <button id="toggle-${id}" class="${btnClass}" style="width: 100px">${btnText}</button>
          <button id="remove-${id}" class="b-zakoncz" style="width: 100px">Zakończ</button>
        </div>
      `;
      container.appendChild(timerEl);
      document.getElementById('toggle-'+id).addEventListener('click', () => toggleTimer(id));
      document.getElementById('remove-'+id).addEventListener('click', () => removeTimer(id));
    }

    function addTimer(name) {
      const id = ++timerIdCounter;
      timers[id] = { name, elapsed: 0, running: true,
        animationFrame: null, startTime: Date.now() };
      renderTimer(id);
      updateTimer(id);
      saveTimers();
    }

    function updateTimer(id) {
      const t = timers[id]; if (!t.running) return;
      const now = Date.now();
      t.elapsed = now - t.startTime;
      document.getElementById('time-'+id).textContent = formatTime(t.elapsed);
      t.animationFrame = requestAnimationFrame(() => updateTimer(id));
    }

    function toggleTimer(id) {
      const t = timers[id];
      const btn = document.getElementById('toggle-'+id);
      if (t.running) {
        cancelAnimationFrame(t.animationFrame);
        t.running = false;
        t.elapsed = Date.now() - t.startTime;
        btn.textContent = 'Wznów';
        btn.className = 'b-wznow';
      } else {
        t.running = true;
        t.startTime = Date.now() - t.elapsed;
        btn.textContent = 'Zatrzymaj';
        btn.className = 'b-zatrzymaj';
        updateTimer(id);
      }
      saveTimers();
    }

    function removeTimer(id) {
      const t = timers[id];
      if (t.animationFrame) cancelAnimationFrame(t.animationFrame);
      delete timers[id];
      const el = document.getElementById('timer-'+id); if (el) el.remove();
      saveTimers();
    }

    function formatTime(ms) {
      const totalSeconds = Math.floor(ms/1000);
      const h = String(Math.floor(totalSeconds/3600)).padStart(2,'0');
      const m = String(Math.floor((totalSeconds%3600)/60)).padStart(2,'0');
      const s = String(totalSeconds%60).padStart(2,'0');
      return `${h}:${m}:${s}`;
    }

    document.getElementById('timerForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('timerName').value.trim();
      if (!name) return;
      addTimer(name);
      this.reset();
    });

    window.addEventListener('load', loadTimers);
    window.addEventListener('beforeunload', saveTimers);
  </script>
</body>
</html>
